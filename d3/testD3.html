<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    #chart div {
      display: inline-block;
      background: #4285F4;
      width: 20px;
      margin-right: 3px;
    }

    #chart2 div {
      display: inline-block;
      width: 20px;
      height: 20px;
      margin-right: 3px;
    }
  </style>
</head>

<body>

  <div id="chart"></div>
  <div id="chart2">
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
  </div>
  <div id="chart3">
    <p></p>
  </div>

  <p></p>
  <p></p>

  <svg width="460" height="300"></svg>

  <script type="text/javascript" src="http://d3js.org/d3.v5.min.js"></script>
  <script>
    //api熟悉
    d3.select('#chart')
      .selectAll("div")
      .data([4, 8, 15, 16, 23, 42])
      .enter()  //返回输入 以下是
      .append("div")
      .style("height", (d) => d + "px")  //这里传入的d是data的数据

    const colorMap = d3.interpolateRgb(
      d3.rgb('#d6e685'),
      d3.rgb('#1e6823')
    );

    const update = d3.select('#chart2')
      .selectAll("div")
      .data([.2, .4, 0, 0, .13, .92])
    // .remove()

    d3.select('#chart2')
      .select("div").remove()

    const exit = update.exit()
    update
      .style("background-color", (d) => {
        return d == 0 ? 'red' : colorMap(d);
      })

    exit
      .text(() => "exit")

    d3.select('#chart3')
      .selectAll("p")
      .datum(4)
      .text(function (d, i) {
        return "第" + i + "个元素" + d;
      })


    //简单图标
    var marge = { top: 60, bottom: 60, left: 60, right: 60 }//设置边距
    var dataset = [2.5, 2.1, 1.7, 1.3, 1, 5];  //数据（表示矩形的宽度）
    var rectHeight = 30;//设置每一个矩形的高度
    var min = d3.min(dataset);//得到最小值
    var max = d3.max(dataset);//得到最大值
    var svg = d3.select("svg");//得到svg画布
    var height = svg.attr("height");//得到画布的长
    var g = svg.append("g")//定义一个用来装整个图表的一个分组，并设置他的位置
      .attr("transform", "translate(" + marge.top + "," + marge.left + ")");

    var scaleLinear = d3.scaleLinear()
      .domain([min, max])
      .range([50, 300]);

    //为坐标轴定义一个线性比例尺
    var xScale = d3.scaleLinear()
      .domain([0, max])
      .range([0, 350])

    //定义一个坐标轴
    var xAxis = d3.axisBottom(xScale)//定义一个axis，由bottom可知，是朝下的
      .ticks(7);//设置刻度数目

    g.append("g")
      .attr("transform", "translate(" + 10 + "," + (dataset.length * rectHeight) + ")")
      .call(xAxis);

    var yScale = d3.scaleBand()
      .domain(d3.range(dataset.length))
      .rangeRound([height - marge.top - marge.bottom, 0]);
    var yAxis = d3.axisLeft(yScale).ticks(dataset.length)

    g.append("g")
      .attr("transform", "translate(" + 10 + "," + (0) + ")")
      .call(yAxis);

    var gs = g.selectAll(".rect")
      .data(dataset)
      .enter()
      .append("g")

    //图
    gs.append("rect")
      .attr("x", 20)//设置左上点的x
      .attr("y", function (d, i) {//设置左上点的y
        return i * rectHeight;
      })
      .attr("width", function (d) {//设置宽
        // return scaleLinear(d);
        return 0
      })
      .attr("height", rectHeight - 5)//设置长
      .attr("fill", "blue")//颜色填充
      
      //动画效果
      g.selectAll("rect").transition()//添加过渡
      .duration(800)//持续时间
      .delay(function (d, i) {//延迟
        return i * 400;
      })
      // .ease(d3.easeElasticInOut)//这里读者可以自己将注释去掉，看看效果（chrome浏览器会报错，但是不影响效果）
      .attr("width", function (d) {//回到最终状态
        return scaleLinear(d);
      })
      
      //点击事件
      g.selectAll("rect")
      .on("mouseover", function () {
        var rect = d3.select(this)
          .transition()
          .duration(1000)
          .attr("fill", "yellow");
      })
      .on("mouseout", function () {
        var rect = d3.select(this)
          .transition()
          .delay(500)
          .duration(500)
          .attr("fill", "blue");
      })
      .on("click", function () {
        var rect = d3.select(this)
       console.log(`点击了${rect}`)
      })


    //文字
    gs.append("text")
      .attr("x", function (d, i) {

        return 0
      })
      .attr("y", function (d,i) {
        return yScale(dataset.length-i-1) + rectHeight / 2;
      })
      .text(function (d,i) {
        return d
      })
      .transition()
      .duration(1000)
      .delay(function (d, i) {
        return i * 400;
      })
      .attr("x", function (d) {
        return xScale(d)
      })



  </script>
</body>

</html>